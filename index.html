<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Spelling Bee Practice</title>
    <style>
      :root {
        --bg: #0f1724;
        --card: #0b1220;
        --muted: #9aa4b2;
        --accent: #7dd3fc;
        --accent-2: #60a5fa;
        --success: #34d399;
        --danger: #fb7185;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: Inter, Segoe UI, Arial, sans-serif;
        background: linear-gradient(180deg, #071024 0%, #071a2b 100%);
        color: #e6eef6;
        padding: 20px;
      }

      .card {
        width: 100%;
        max-width: 760px;
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.02),
          rgba(0, 0, 0, 0.04)
        );
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 8px 30px rgba(2, 6, 23, 0.6);
      }

      header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
      }

      /* Three-part header: left 30%, middle 30%, right 40% */
      header .header-left {
        flex: 0 0 30%;
      }

      header .header-middle {
        flex: 0 0 30%;
        display: flex;
        align-items: center;
      }

      header .header-right {
        flex: 0 0 40%;
        display: flex;
        align-items: center;
        justify-content: flex-end;
      }

      header h1 {
        font-size: 1.25rem;
        margin: 0;
      }

      .controls {
        display: flex;
        gap: 8px;
        align-items: center;
      }

      .file-drop {
        flex: 1;
        display: flex;
        gap: 8px;
        align-items: center;
      }

      .drop-area {
        flex: 1;
        border: 2px dashed rgba(255, 255, 255, 0.06);
        border-radius: 8px;
        padding: 8px 12px;
        color: var(--muted);
        background: rgba(255, 255, 255, 0.01);
        cursor: pointer;
      }

      input[type="file"] {
        display: none;
      }

      .toolbar button {
        background: transparent;
        border: 1px solid rgba(255, 255, 255, 0.06);
        color: var(--accent);
        padding: 8px 12px;
        border-radius: 8px;
        cursor: pointer;
      }

      /* center buttons inside the toolbar */
      .toolbar {
        display: flex;
        gap: 8px;
        justify-content: center;
        align-items: center;
      }

      .toolbar button.primary {
        background: linear-gradient(90deg, var(--accent), var(--accent-2));
        color: #02203a;
        border: none;
      }

      main {
        margin-top: 18px;
        display: grid;
        grid-template-columns: 1fr 260px;
        gap: 18px;
      }

      .practice {
        padding: 18px;
        background: rgba(255, 255, 255, 0.02);
        border-radius: 8px;
      }

      .info {
        padding: 18px;
        background: rgba(255, 255, 255, 0.015);
        border-radius: 8px;
      }

      .big-input {
        width: 100%;
        padding: 12px 14px;
        font-size: 1.05rem;
        border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0.04);
        background: transparent;
        color: inherit;
      }

      .muted {
        color: var(--muted);
        font-size: 0.9rem;
      }

      .row {
        display: flex;
        gap: 8px;
        align-items: center;
      }

      .btn {
        padding: 8px 12px;
        border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0.06);
        background: transparent;
        color: var(--accent);
        cursor: pointer;
      }

      .btn.ghost {
        background: transparent;
      }

      .status {
        margin-top: 12px;
        font-weight: 600;
      }

      .feedback {
        margin-top: 12px;
        font-size: 1rem;
      }

      .progress-bar {
        height: 10px;
        background: rgba(255, 255, 255, 0.04);
        border-radius: 999px;
        overflow: hidden;
      }

      .progress-bar > i {
        display: block;
        height: 100%;
        width: 0;
        background: linear-gradient(90deg, var(--accent), var(--accent-2));
        transition: width 350ms ease;
      }

      .clue {
        letter-spacing: 6px;
        font-size: 1.1rem;
        margin-top: 12px;
        color: var(--muted);
      }

      .small {
        font-size: 0.85rem;
      }

      .wrong-words-list {
        margin-top: 12px;
        padding: 12px;
        background: rgba(251, 113, 133, 0.1);
        border: 1px solid rgba(251, 113, 133, 0.3);
        border-radius: 8px;
        max-height: 250px;
        overflow-y: auto;
      }

      .wrong-words-list ul {
        margin: 0;
        padding-left: 20px;
        list-style-type: disc;
      }

      .wrong-words-list li {
        color: var(--danger);
        font-size: 0.9rem;
        margin: 6px 0;
      }

      .samples-selector {
        margin-top: 12px;
      }

      .samples-selector label {
        display: block;
        margin-bottom: 6px;
        font-size: 0.9rem;
        color: var(--muted);
      }

      #sampleSelect {
        width: 100%;
        padding: 8px;
        border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0.06);
        background: rgba(0, 0, 0, 0.3);
        color: #e6eef6;
        cursor: pointer;
        font-size: 0.9rem;
      }

      #sampleSelect option {
        background: #0f1724;
        color: #e6eef6;
      }

      #loadSampleBtn {
        width: 100%;
        margin-top: 6px;
        padding: 8px;
        background: rgba(125, 211, 252, 0.2);
        border: 1px solid rgba(125, 211, 252, 0.5);
        color: var(--accent);
        border-radius: 8px;
        cursor: pointer;
        font-size: 0.9rem;
      }

      #loadSampleBtn:hover {
        background: rgba(125, 211, 252, 0.3);
      }

      footer {
        margin-top: 16px;
        text-align: right;
        color: var(--muted);
      }

      @media (max-width: 800px) {
        main {
          grid-template-columns: 1fr;
        }

        /* stack header parts on small screens */
        header {
          flex-direction: column;
          align-items: stretch;
          gap: 8px;
        }

        header .header-left,
        header .header-middle,
        header .header-right {
          flex: 0 0 auto;
          width: 100%;
        }
      }
    </style>
  </head>

  <body>
    <div class="card">
      <header>
        <div>
          <div class="header-left">
            <h1>Spelling Bee Practice</h1>
            <div class="muted small">
              Load a plain .txt (one word per line) or drop a file ‚Äî then
              practice.
            </div>
          </div>
          <div class="header-middle">
            <div class="file-drop" title="Click to select or drop file">
              <label class="drop-area" id="dropArea">üìÅ Drop or Upload</label>
              <input id="fileInput" type="file" accept=".txt" />
            </div>
          </div>
          <div id="fileName" class="muted small" style="margin-left: 8px">
            No file selected
          </div>
        </div>
        <div class="header-right">
          <div class="toolbar">
            <button id="shuffleBtn" class="btn">üîÄ Shuffle</button>
            <button id="restartBtn" class="btn">‚Ü∫ Restart</button>
          </div>
        </div>
      </header>

      <main>
        <section class="practice" id="practiceArea" style="display: none">
          <div
            class="row"
            style="justify-content: space-between; align-items: center"
          >
            <div class="muted small" id="progressText">Word 0 of 0</div>
            <div class="row">
              <button id="readWordBtn" class="btn">üîä Read</button>
              <button id="revealBtn" class="btn">üí° Reveal</button>
              <button id="reviewBtn" class="btn">üìã Review</button>
            </div>
          </div>

          <div class="progress-bar" aria-hidden="true" style="margin-top: 10px">
            <i id="progressFill"></i>
          </div>

          <div class="clue" id="clue">_ _ _ _</div>

          <input
            id="spellingInput"
            class="big-input"
            placeholder="Type spelling here"
            autocomplete="off"
          />

          <div class="row" style="margin-top: 10px">
            <button id="checkBtn" class="btn primary">Check</button>
            <button id="nextBtn" class="btn" disabled>Next</button>
            <div style="flex: 1"></div>
            <div class="muted small" id="streak">Streak: 0</div>
          </div>

          <div class="feedback" id="feedback"></div>
        </section>

        <aside class="info">
          <!-- Score and Correct % removed per user request -->

          <hr
            style="
              margin: 12px 0;
              border: none;
              height: 1px;
              background: rgba(255, 255, 255, 0.03);
            "
          />

          <div class="muted small">Controls</div>
          <ul class="muted small">
            <li>Enter = Check</li>
            <li>Reveal shows spelling</li>
            <li>Shuffle randomizes words</li>
            <li>Restart to begin from start</li>
            <li>Review to view if any wrong words</li>
          </ul>

          <div
            id="wrongWordsContainer"
            class="wrong-words-list"
            style="display: none"
          >
            <div
              style="
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 8px;
              "
            >
              <div class="muted small">‚ùå Wrong words:</div>
              <button id="retryWrongBtn" class="btn" style="margin-left: 8px">
                üîÅ Retry
              </button>
            </div>
            <ul id="wrongWordsList"></ul>
          </div>

          <div class="samples-selector">
            <label for="sampleSelect">üìö Sample Word Lists:</label>
            <select id="sampleSelect">
              <option value="">-- Choose a sample --</option>
            </select>
            <button id="loadSampleBtn">üìñ Load Sample</button>
          </div>
        </aside>
      </main>

      <footer>
        Built for quick practice ‚Ä¢ Drag & drop a .txt with one word per line
      </footer>
    </div>

    <script>
      // State
      let words = [],
        current = 0;
      let correctCount = 0,
        attempts = 0,
        streak = 0;
      let wrongWords = [];
      let originalWords = [];
      let isReviewingWrong = false;

      // Elements
      const fileInput = document.getElementById("fileInput");
      const dropArea = document.getElementById("dropArea");
      const fileNameEl = document.getElementById("fileName");
      const practiceArea = document.getElementById("practiceArea");
      const spellingInput = document.getElementById("spellingInput");
      const feedback = document.getElementById("feedback");
      const progressText = document.getElementById("progressText");
      const nextBtn = document.getElementById("nextBtn");
      const readWordBtn = document.getElementById("readWordBtn");
      const checkBtn = document.getElementById("checkBtn");
      const revealBtn = document.getElementById("revealBtn");
      const progressFill = document.getElementById("progressFill");
      const clue = document.getElementById("clue");
      /* Score and percent elements removed */
      const streakEl = document.getElementById("streak");
      const wordCountEl = document.getElementById("wordCount");
      const shuffleBtn = document.getElementById("shuffleBtn");
      const restartBtn = document.getElementById("restartBtn");
      const reviewBtn = document.getElementById("reviewBtn");
      const wrongWordsContainer = document.getElementById(
        "wrongWordsContainer"
      );
      const wrongWordsList = document.getElementById("wrongWordsList");
      const retryWrongBtn = document.getElementById("retryWrongBtn");
      const sampleSelect = document.getElementById("sampleSelect");
      const loadSampleBtn = document.getElementById("loadSampleBtn");

      // Helpers
      function setProgress() {
        progressText.textContent = `Word ${Math.min(
          current + 1,
          words.length
        )} of ${words.length}`;
        const p = words.length ? Math.round((current / words.length) * 100) : 0;
        progressFill.style.width = p + "%";
      }

      function updateStats() {
        streakEl.textContent = `Streak: ${streak}`;
      }

      function showClue() {
        const w = words[current] || "";
        if (!w) {
          clue.textContent = "";
          return;
        }
        clue.textContent = w.replace(/./g, "_ ").trim();
      }

      function readCurrent() {
        const w = words[current];
        if (!w) return;
        const u = new SpeechSynthesisUtterance(w);
        // slower speech rate for clearer enunciation
        try {
          u.rate = 0.25;
        } catch (e) {
          /* some browsers may ignore invalid values */
        }
        window.speechSynthesis.cancel();
        window.speechSynthesis.speak(u);
      }

      function loadWordsFromText(text) {
        words = text
          .split(/\r?\n/)
          .map((s) => s.trim())
          .filter(Boolean);
        current = 0;
        correctCount = 0;
        attempts = 0;
        streak = 0;
        wrongWords = [];
        // keep a copy of the original full list so we can restore it later
        originalWords = words.slice();
        isReviewingWrong = false;
        wordCountEl.textContent = words.length;
        practiceArea.style.display = words.length ? "block" : "none";
        wrongWordsContainer.style.display = "none";
        // hide the Review button until there are wrong words to review
        if (reviewBtn) reviewBtn.style.display = "none";
        setProgress();
        updateStats();
        showClue();
        spellingInput.value = "";
        feedback.textContent = "";
        if (words.length) readCurrent();
      }

      function updateWrongWordsList() {
        if (wrongWords.length > 0) {
          // populate the list but do NOT auto-show the container; show it only when Review is clicked
          wrongWordsList.innerHTML = wrongWords
            .map((w) => `<li>${w}</li>`)
            .join("");
          if (reviewBtn) reviewBtn.style.display = "inline-block";
        } else {
          wrongWordsList.innerHTML = "";
          if (reviewBtn) reviewBtn.style.display = "none";
          wrongWordsContainer.style.display = "none";
        }
      }

      // File input and drag/drop
      dropArea.addEventListener("click", () => fileInput.click());
      fileInput.addEventListener("change", (e) => {
        const f = e.target.files[0];
        if (!f) return;
        if (fileNameEl) fileNameEl.textContent = f.name;
        const r = new FileReader();
        r.onload = (ev) => loadWordsFromText(ev.target.result);
        r.readAsText(f);
      });
      ["dragenter", "dragover"].forEach((ev) =>
        dropArea.addEventListener(ev, (e) => {
          e.preventDefault();
          dropArea.style.opacity = 0.9;
        })
      );
      ["dragleave", "drop"].forEach((ev) =>
        dropArea.addEventListener(ev, (e) => {
          e.preventDefault();
          dropArea.style.opacity = 1;
        })
      );
      dropArea.addEventListener("drop", (e) => {
        const f = e.dataTransfer.files[0];
        if (!f) return;
        if (fileNameEl) fileNameEl.textContent = f.name;
        const r = new FileReader();
        r.onload = (ev) => loadWordsFromText(ev.target.result);
        r.readAsText(f);
      });

      // Controls
      readWordBtn.addEventListener("click", () => readCurrent());
      revealBtn.addEventListener("click", () => {
        const w = words[current] || "";
        if (!w) return;
        feedback.innerHTML = `<span style="color:var(--accent)">Revealed:</span> <strong>${w}</strong>`;
        nextBtn.disabled = false;
        readWordBtn.disabled = true;
      });

      reviewBtn.addEventListener("click", () => {
        wrongWordsContainer.style.display =
          wrongWordsContainer.style.display === "none" ? "block" : "none";
      });

      retryWrongBtn.addEventListener("click", () => {
        // If there are no wrong words, do nothing
        if (!wrongWords || wrongWords.length === 0) return;
        // Enter review mode and replace the current words list with the wrong words
        isReviewingWrong = true;
        words = wrongWords.slice();
        current = 0;
        correctCount = 0;
        attempts = 0;
        streak = 0;
        // hide the wrong words box while practicing
        wrongWordsContainer.style.display = "none";
        setProgress();
        updateStats();
        showClue();
        practiceArea.style.display = "block";
        spellingInput.value = "";
        feedback.textContent = "";
        if (words.length) readCurrent();
      });

      checkBtn.addEventListener("click", () => {
        const entered = spellingInput.value.trim();
        if (!entered) return;
        const correct = (words[current] || "").trim();
        attempts++;
        if (entered.toLowerCase() === correct.toLowerCase()) {
          correctCount++;
          streak++;
          feedback.innerHTML = `<span style="color:var(--success)">‚úÖ Correct!</span>`;
        } else {
          streak = 0;
          if (!wrongWords.includes(correct)) {
            wrongWords.push(correct);
            updateWrongWordsList();
          }
          feedback.innerHTML = `<span style="color:var(--danger)">‚ùå Incorrect.</span> Correct: <strong>${correct}</strong>`;
        }
        updateStats();
        readWordBtn.disabled = true;
        nextBtn.disabled = false;
      });

      nextBtn.addEventListener("click", () => {
        current++;
        if (current < words.length) {
          spellingInput.value = "";
          feedback.textContent = "";
          readWordBtn.disabled = false;
          nextBtn.disabled = true;
          setProgress();
          showClue();
          readCurrent();
          spellingInput.focus();
        } else {
          feedback.innerHTML = "üéâ Practice complete!";
          practiceArea.style.display = "none";
        }
      });

      spellingInput.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          e.preventDefault();
          // If Next is enabled, prefer Next; otherwise fall back to Check
          if (nextBtn && !nextBtn.disabled) nextBtn.click();
          else if (checkBtn) checkBtn.click();
        }
      });

      // Extras
      shuffleBtn.addEventListener("click", () => {
        for (let i = words.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [words[i], words[j]] = [words[j], words[i]];
        }
        current = 0;
        correctCount = 0;
        attempts = 0;
        streak = 0;
        wrongWords = [];
        wrongWordsContainer.style.display = "none";
        if (reviewBtn) reviewBtn.style.display = "none";
        updateStats();
        setProgress();
        showClue();
        readCurrent();
      });

      restartBtn.addEventListener("click", () => {
        // Restore the original full list (if present) and reset state
        if (originalWords && originalWords.length) {
          words = originalWords.slice();
        }
        isReviewingWrong = false;
        current = 0;
        correctCount = 0;
        attempts = 0;
        streak = 0;
        wrongWords = [];
        wrongWordsContainer.style.display = "none";
        if (reviewBtn) reviewBtn.style.display = "none";
        updateStats();
        setProgress();
        showClue();
        practiceArea.style.display = words.length ? "block" : "none";
        spellingInput.value = "";
        feedback.textContent = "";
        readCurrent();
      });

      // Samples handling - dynamically fetch from samples.json
      async function loadSamplesDropdown() {
        try {
          console.log("Fetching samples.json...");
          const response = await fetch("./samples/samples.json");
          console.log("Response status:", response.status);
          if (!response.ok) throw new Error("Failed to load samples list");
          const sampleFiles = await response.json();
          console.log("Loaded samples:", sampleFiles);

          // Populate samples dropdown
          sampleFiles.forEach((sample) => {
            const option = document.createElement("option");
            option.value = `./samples/${sample.file}`;
            option.textContent = sample.name;
            option.title = sample.description;
            sampleSelect.appendChild(option);
            console.log("Added option:", sample.name);
          });
          console.log("Dropdown populated with", sampleFiles.length, "items");
        } catch (error) {
          console.error("Error loading samples list:", error);
        }
      }

      // Load dropdown on page load
      console.log("sampleSelect element:", sampleSelect);
      loadSamplesDropdown();

      // Load sample file on button click
      loadSampleBtn.addEventListener("click", async () => {
        const selectedFile = sampleSelect.value;
        if (!selectedFile) {
          alert("Please select a sample word list");
          return;
        }
        try {
          const response = await fetch(selectedFile);
          if (!response.ok) throw new Error("Failed to load sample");
          const text = await response.text();
          loadWordsFromText(text);
          fileNameEl.textContent =
            sampleSelect.options[sampleSelect.selectedIndex].text;
        } catch (error) {
          alert("Error loading sample: " + error.message);
        }
      });

      // small helper to set initial empty clue
      setProgress();
      updateStats();
      showClue();
    </script>
  </body>
</html>
